# üîß SQL Migration –¥–ª—è Stories Reactions

## ‚ö†Ô∏è –í–ê–ñ–ù–û: –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º!

–î–ª—è —Ä–∞–±–æ—Ç—ã —Ä–µ–∞–∫—Ü–∏–π –Ω–∞ Stories –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å SQL –º–∏–≥—Ä–∞—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–∑–¥–∞—Å—Ç –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É `Wo_StoryReactions` –∏ –¥–æ–±–∞–≤–∏—Ç —Å—á–µ—Ç—á–∏–∫–∏ –≤ `Wo_UserStory`.

---

## üöÄ –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ phpMyAdmin (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –û—Ç–∫—Ä–æ–π—Ç–µ phpMyAdmin
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à—É –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö (–æ–±—ã—á–Ω–æ `socialhub`)
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **SQL**
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `migration_story_reactions_simple.sql`
5. –ù–∞–∂–º–∏—Ç–µ **–í—ã–ø–æ–ª–Ω–∏—Ç—å**

–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫–∏ —Ç–∏–ø–∞ "Column already exists" - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ.

---

## üöÄ –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É

```bash
mysql -u username -p database_name < migration_story_reactions_simple.sql
```

–ó–∞–º–µ–Ω–∏—Ç–µ:
- `username` –Ω–∞ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è MySQL
- `database_name` –Ω–∞ –∏–º—è –≤–∞—à–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ MySQL:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü—ã Wo_StoryReactions
SHOW TABLES LIKE 'Wo_StoryReactions';

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–æ–Ω–æ–∫ –≤ Wo_UserStory
DESCRIBE Wo_UserStory;
```

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `Wo_StoryReactions` —Å–æ–∑–¥–∞–Ω–∞
- ‚úÖ –ö–æ–ª–æ–Ω–∫–∞ `comment_count` –≤ `Wo_UserStory`
- ‚úÖ –ö–æ–ª–æ–Ω–∫–∞ `reaction_count` –≤ `Wo_UserStory`

---

## üêõ –ï—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –û—à–∏–±–∫–∞: "Table already exists"
–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ - —Ç–∞–±–ª–∏—Ü–∞ —É–∂–µ —Å–æ–∑–¥–∞–Ω–∞. –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.

### –û—à–∏–±–∫–∞: "Column already exists"
–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ - –∫–æ–ª–æ–Ω–∫–∞ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞. –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.

### –û—à–∏–±–∫–∞: "Unknown column"
–í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–∞–∂–¥—É—é –∫–æ–º–∞–Ω–¥—É –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏:

1. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã:
```sql
CREATE TABLE IF NOT EXISTS `Wo_StoryReactions` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `story_id` int(11) NOT NULL DEFAULT 0,
  `user_id` int(11) NOT NULL DEFAULT 0,
  `reaction` varchar(30) NOT NULL DEFAULT 'like',
  `time` int(11) NOT NULL DEFAULT 0,
  PRIMARY KEY (`id`),
  UNIQUE KEY `unique_story_user` (`story_id`, `user_id`)
) ENGINE=InnoDB;
```

2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ comment_count:
```sql
ALTER TABLE `Wo_UserStory` ADD COLUMN `comment_count` int(11) NOT NULL DEFAULT 0;
```

3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ reaction_count:
```sql
ALTER TABLE `Wo_UserStory` ADD COLUMN `reaction_count` int(11) NOT NULL DEFAULT 0;
```

---

## üìä –ß—Ç–æ —Å–æ–∑–¥–∞–µ—Ç –º–∏–≥—Ä–∞—Ü–∏—è

### –¢–∞–±–ª–∏—Ü–∞ `Wo_StoryReactions`:
| –ö–æ–ª–æ–Ω–∫–∞ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|-----|----------|
| id | int(11) | PRIMARY KEY |
| story_id | int(11) | ID story |
| user_id | int(11) | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| reaction | varchar(30) | –¢–∏–ø —Ä–µ–∞–∫—Ü–∏–∏ (like, love, haha, wow, sad, angry) |
| time | int(11) | Unix timestamp |

**–ò–Ω–¥–µ–∫—Å—ã:**
- UNIQUE: (story_id, user_id) - –æ–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = –æ–¥–Ω–∞ —Ä–µ–∞–∫—Ü–∏—è
- INDEX: story_id, user_id

### –ù–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –≤ `Wo_UserStory`:
- `comment_count` - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
- `reaction_count` - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∞–∫—Ü–∏–π

---

## üéØ –ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
- ‚úÖ Stories –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è
- ‚úÖ –†–µ–∞–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç (–Ω–µ—Ç HTTP 500)
- ‚úÖ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç (–Ω–µ—Ç HTTP 500)
- ‚úÖ –°—á–µ—Ç—á–∏–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è

---

## üìù –õ–æ–≥–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

–ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ PHP:
```bash
tail -f /path/to/api/v2/logs/*.log
```

–ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ —Ç–∏–ø–∞:
- ‚ùå "Table 'Wo_StoryReactions' doesn't exist"
- ‚ùå "Unknown column 'comment_count'"
- ‚ùå "Unknown column 'reaction_count'"
