# ============================================================================
# Coturn TURN Server Configuration
# /etc/coturn/turnserver.conf
# 
# TURN сервер для WebRTC (видеоконференцій у WorldMates Messenger)
# ============================================================================

# ============================================================================
# ОСНОВНІ ПАРАМЕТРИ
# ============================================================================

# Прослуховування портів
listening-port=3478
listening-ip=0.0.0.0
listening-ip=[::]

# TURN TCP порт (для слабких мереж)
tcp-listening-port=3478
tcp-listening-ip=0.0.0.0
tcp-listening-ip=[::]

# ============================================================================
# TLS КОНФІГУРАЦІЯ (для TURN over TLS)
# ============================================================================

# TURN over TLS (рекомендується для продакшну)
tls-listening-port=5349
tls-listening-ip=0.0.0.0
tls-listening-ip=[::]

# Дозволи кертифікати Let's Encrypt
# Встановити спочатку: sudo apt-get install certbot
# Отримати: sudo certbot certonly --standalone -d your-domain.com
cert=/etc/letsencrypt/live/your-domain.com/fullchain.pem
pkey=/etc/letsencrypt/live/your-domain.com/privkey.pem

# Альтернатива: самопідписаний сертифікат
# openssl req -x509 -newkey rsa:2048 -keyout turn_server_pkey.pem -out turn_server_cert.pem -days 99999 -nodes

# ============================================================================
# АУТЕНТИФІКАЦІЯ
# ============================================================================

# Realm (домен)
realm=your-domain.com

# Користувачі TURN (простий спосіб)
# user=webrtc:webrtcpass123
# user=streaming:streamingpass456

# АБО через файл
# userdb=/etc/coturn/turnusers.conf

# ============================================================================
#論ЙМФОРМАНС І ЛІМАТИ
# ============================================================================

# Максимальна кількість одночасних з'єднань
max-bps=0
bps-capacity=0

# Обмеження на одного користувача (кбіт/с)
# 0 = без обмежень
bps-capacity-divisor=0

# Максимум 6-байтных relayed packets
max-allocate-timeout=600

# Максимум дозволених address family'ї
# IPv4 та IPv6
external-ip=YOUR_PUBLIC_IP/0.0.0.0

# ============================================================================
# LOGGING
# ============================================================================

# Файл логів
log-file=/var/log/coturn/turnserver.log

# Рівень логування
# 0 = Normal
# 1 = Verbose  
# 2 = Debug
log-level=0

# Простий формат логу
simple-log

# Відключити логування деяких типів пакетів
# no-loopback-peers

# ============================================================================
# БЕЗПЕКА
# ============================================================================

# Заборонити реле до приватних адрес
# no-loopback-peers
# no-multicast-peers

# Разрешить доступ до цих адрес (NAT за NAT)
# allowed-peer-ip=192.168.1.0/24
# allowed-peer-ip=10.0.0.0/8

# ============================================================================
# RELAY КОНФІГУРАЦІЯ
# ============================================================================

# Внутрішня IP (якщо за NAT)
# relay-ip=192.168.1.100

# Зовнішня IP (яку повинен повідомляти TURN)
# external-ip=203.0.113.1/0.0.0.0

# ============================================================================
# СТАНТАСТИКА
# ============================================================================

# Зберігати статистику
# 0 = відключено
# 1 = увімкнено
# stats-log-file=/var/log/coturn/stats.log

# ============================================================================
# ВСПОМОГАТЕЛЬНІ ОПЦІЇ
# ============================================================================

# Мінімальна TLS версія
# TLSv1.2
# fingerprint

# Дозволити UDP
allow-loopback-peers

# Дозволити паралельні обробники
stale-nonce
movement-timeout=600

# Динамічна мнихідна порт (для NAT traversal)
min-external-port=49152
max-external-port=65535

# ============================================================================
# ПРИКЛАД КОНФІГУРАЦІЇ ДЛЯ РОЗРОБКИ
# ============================================================================

# listening-port=3478
# listening-ip=0.0.0.0
# realm=localhost
# user=test:test123
# log-file=/var/log/coturn/turnserver.log
# simple-log

# ============================================================================
# ПРИКЛАД КОНФІГУРАЦІЇ ДЛЯ ПРОДАКШНУ
# ============================================================================

# listening-port=3478
# tls-listening-port=5349
# listening-ip=0.0.0.0
# listening-ip=[::]
# external-ip=YOUR_PUBLIC_IP/0.0.0.0
# realm=your-domain.com
# cert=/etc/letsencrypt/live/your-domain.com/fullchain.pem
# pkey=/etc/letsencrypt/live/your-domain.com/privkey.pem
# user=webrtc:securepassword123
# log-file=/var/log/coturn/turnserver.log
# log-level=1
# simple-log

# ============================================================================
# ВАЖЛИВІ ЗАМІТКИ
# ============================================================================

# 1. ДОЗВОЛИ FIREWALL
#    sudo ufw allow 3478/tcp
#    sudo ufw allow 3478/udp
#    sudo ufw allow 5349/tcp
#    sudo ufw allow 5349/udp
#
# 2. ВСТАНОВИТИ COTURN
#    sudo apt-get update
#    sudo apt-get install coturn
#
# 3. ЗАПУСТИТИ
#    sudo systemctl start coturn
#    sudo systemctl enable coturn
#    sudo systemctl status coturn
#
# 4. ЛОГИ
#    tail -f /var/log/coturn/turnserver.log
#
# 5. ТЕСТУВАННЯ
#    stunclient your-server.com 3478
#
# 6. МОНИТОРИНГ
#    ps aux | grep turnserver
#    netstat -tlnup | grep turnserver
#
# 7. РЕСТАРТ
#    sudo systemctl restart coturn
#
# ============================================================================